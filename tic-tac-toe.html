<html>
    <head>
        <style>
            body { margin: 0; padding: 0; }
        </style>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/p5.js/0.4.5/p5.js"></script>
        <script>

        var turn = 0
        var end = false;
        var field = [
                     [2, 2, 2],
                     [2, 2, 2],
                     [2, 2, 2]
                    ]

        function setup() {
            createCanvas(600, 300);
            noFill()
            rect(0, 0, 299, 299)
            rect(0, 0, 299, 199)
            rect(0, 0, 299, 99)
            rect(0, 0, 199, 299)
            rect(0, 0, 99, 299)
        }

        function checkWin() {
            for (var i = 0; i < 3; ++i) {
                var rows = [0, 0, 0];
                var columns = [0, 0, 0];
                for (var j = 0; j < 3; ++j) {
                    rows[field[i][j]]++;
                    columns[field[j][i]]++;
                }
                if (rows[0] == 3 || columns[0] == 3) {
                    return 0;
                }
                if (rows[1] == 3 || columns[1] == 3) {
                    return 1;
                }
            }

            var diag = [0, 0, 0];
            var inv_diag = [0, 0, 0];

            for (var i = 0; i < 3; ++i) {
                diag[field[i][i]]++;
                inv_diag[field[2 - i][i]]++;
            }
            if (diag[0] == 3 || inv_diag[0] == 3) {
                return 0;
            }
            if (diag[1] == 3 || inv_diag[1] == 3) {
                return 1;
            }
            return 2;
        }

        function makeTurn(column, row) {
            if (end || field[row][column] != 2) {
                return false;
            }

            if (turn == 0) {
                ellipse(100 * column + 50, 100 * row + 50, 50, 50);
            } else {
                line(100 * column + 10,
                     100 * row + 10, 
                     100 * (column + 1) - 10, 
                     100 * (row + 1) - 10);

                line(100 * (column + 1) - 10, 
                     100 * row + 10, 
                     100 * column + 10,
                     100 * (row + 1) - 10);
            }
            
            field[row][column] = turn;

            var who = checkWin();
            if (who != 2) {
                alert(who);
                end = true;
            }

            turn = 1 - turn;
        }

        function mouseClicked() {
            column = int(mouseX / 100);
            row = int(mouseY / 100);
            makeTurn(column, row);
            return false;
        }

        function draw() {
        }

        </script>
    </head>
    <body id="body">
    </body>
</html>
